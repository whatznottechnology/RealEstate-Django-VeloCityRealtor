{% extends 'base.html' %}
{% load static %}
{% load theme_filters %}

{% block title %}{{ project.name }} - {{ project.project_by }} | Premium Real Estate{% endblock %}

{% block meta_description %}{{ project.meta_description|default:project.description|truncatewords:30 }}{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #dc2626;
        --secondary-color: #1f2937;
        --accent-color: #f59e0b;
        --light-gray: #f8fafc;
        --border-light: #e2e8f0;
        --text-dark: #1a202c;
        --text-light: #64748b;
        --white: #ffffff;
        --gradient-primary: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        --gradient-dark: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
        --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
        --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
        background-color: var(--light-gray);
        color: var(--text-dark);
    }

    /* Container and Layout */
    .container-fluid {
        max-width: 100%;
        margin: 0 auto;
        padding: 0 1rem;
    }

    .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    @media (min-width: 768px) {
        .container-fluid,
        .container {
            padding: 0 2rem;
        }
    }

    .section {
        padding: 2rem 0;
    }

    @media (min-width: 768px) {
        .section {
            padding: 3rem 0;
        }
    }

    /* Grid System */
    .grid {
        display: grid;
        gap: 1rem;
    }

    .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

    @media (min-width: 768px) {
        .md\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .md\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .md\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .md\:gap-2 { gap: 1.5rem; }
        .grid { gap: 1.5rem; }
    }

    @media (min-width: 1024px) {
        .lg\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .lg\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .lg\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .lg\:grid-cols-5 { grid-template-columns: repeat(5, 1fr); }
    }

    /* Cards and Components */
    .card {
        background: var(--white);
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-light);
        transition: all 0.3s ease;
    }

    .card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-2px);
    }

    .card-compact {
        padding: 1rem;
        border-radius: 0.75rem;
    }

    /* Hero Section */
    .hero-section {
        background: var(--light-gray);
        padding: 1rem 0;
        min-height: 50vh;
    }

    @media (min-width: 768px) {
        .hero-section {
            padding: 1.5rem 0;
            min-height: 60vh;
        }
    }

    .hero-wrapper {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        background: var(--white);
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: var(--shadow-lg);
        min-height: 450px;
    }

    @media (min-width: 1024px) {
        .hero-wrapper {
            flex-direction: row;
            gap: 0;
            min-height: 500px;
        }
    }

    .hero-image-container {
        position: relative;
        width: 100%;
        height: 280px;
    }

    @media (min-width: 1024px) {
        .hero-image-container {
            width: 50%;
            height: auto;
        }
    }

    .hero-image-main {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .hero-image-main img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .hero-content-container {
        width: 100%;
        padding: 1.5rem;
        background: #f8f9fa;
    }

    @media (min-width: 1024px) {
        .hero-content-container {
            width: 50%;
            padding: 2rem;
        }
    }

    .hero-content-inner {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    /* Hero Badges */
    .hero-badges {
        position: absolute;
        top: 1rem;
        left: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .hero-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .hero-badge.premium {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: var(--white);
    }

    .hero-badge.featured {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: var(--white);
    }

    .hero-badge.hot {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        color: var(--white);
    }

    .hero-badge.status {
        background: #10b981;
        color: var(--white);
        padding: 0.375rem 1rem;
        border-radius: 0.25rem;
        font-weight: 600;
        position: absolute;
        top: 1rem;
        right: 1rem;
    }

    /* Hero Logo */
    .hero-logo {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 3rem;
        height: 3rem;
        background: var(--white);
        border-radius: 0.5rem;
        padding: 0.5rem;
        box-shadow: var(--shadow-md);
    }

    .hero-badge.status ~ .hero-logo {
        top: 4rem;
    }

    .hero-logo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    /* Content Styling */
    .developer-tag {
        color: #dc2626;
        font-size: 0.7rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        margin-bottom: 0.4rem;
    }

    .hero-title {
        font-size: 1.6rem;
        font-weight: 800;
        color: #1e293b;
        line-height: 1.1;
        margin-bottom: 0.6rem;
    }

    @media (min-width: 768px) {
        .hero-title {
            font-size: 1.9rem;
        }
    }

    .hero-price {
        font-size: 1.3rem;
        font-weight: 700;
        color: #dc2626;
        margin-bottom: 0.4rem;
    }

    @media (min-width: 768px) {
        .hero-price {
            font-size: 1.5rem;
        }
    }

    .hero-cta-text {
        color: #64748b;
        font-size: 0.8rem;
        margin-bottom: 1.2rem;
    }

    /* Details Grid */
    .hero-details-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    @media (min-width: 768px) {
        .hero-details-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .detail-item {
        display: flex;
        align-items: flex-start;
        gap: 0.6rem;
        padding: 0.6rem;
        background: var(--white);
        border-radius: 0.4rem;
        border-left: 4px solid #dc2626;
    }

    .detail-item i {
        color: #dc2626;
        font-size: 1rem;
        margin-top: 0.2rem;
        flex-shrink: 0;
    }

    .detail-content {
        display: flex;
        flex-direction: column;
        gap: 0.125rem;
    }

    .detail-label {
        font-size: 0.7rem;
        font-weight: 500;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    .detail-value {
        font-size: 0.8rem;
        font-weight: 600;
        color: #1e293b;
    }

    /* Status Row */
    .hero-status-row {
        display: flex;
        gap: 2rem;
        margin-bottom: 1.5rem;
    }

    @media (max-width: 767px) {
        .hero-status-row {
            flex-direction: column;
            gap: 1rem;
        }
    }

    .status-section {
        flex: 1;
    }

    .status-header {
        font-size: 0.7rem;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.2rem;
    }

    .status-value {
        font-size: 0.8rem;
        font-weight: 600;
        color: #1e293b;
    }

    .possession-date {
        color: #2563eb;
    }

    /* RERA Section */
    .rera-section {
        padding: 1rem;
        background: #fffbeb;
        border: 1px solid #fcd34d;
        border-radius: 0.5rem;
    }

    .rera-header {
        font-size: 0.7rem;
        font-weight: 600;
        color: #92400e;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.2rem;
    }

    .rera-value {
        font-size: 0.875rem;
        font-weight: 600;
        color: #92400e;
        font-family: 'Monaco', 'Menlo', monospace;
    }

    /* Typography */
    .title-primary {
        font-size: 1.75rem;
        font-weight: 800;
        color: var(--text-dark);
        line-height: 1.2;
        margin-bottom: 0.5rem;
    }

    @media (min-width: 768px) {
        .title-primary {
            font-size: 2.5rem;
        }
    }

    @media (min-width: 1024px) {
        .title-primary {
            font-size: 3rem;
        }
    }

    .title-section {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 1rem;
        text-align: center;
    }

    @media (min-width: 768px) {
        .title-section {
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
    }

    .price-primary {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }

    @media (min-width: 768px) {
        .price-primary {
            font-size: 1.5rem;
        }
    }

    @media (min-width: 1024px) {
        .price-primary {
            font-size: 1.875rem;
        }
    }

    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
        border: 2px solid transparent;
        font-size: 0.875rem;
    }

    .btn-primary {
        background: var(--gradient-primary);
        color: var(--white);
        border-color: var(--primary-color);
    }

    .btn-primary:hover {
        background: var(--white);
        color: var(--primary-color);
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
        background: transparent;
        color: var(--text-dark);
        border-color: var(--text-dark);
    }

    .btn-secondary:hover {
        background: var(--text-dark);
        color: var(--white);
        transform: translateY(-2px);
    }

    .btn-white {
        background: var(--white);
        color: var(--primary-color);
        border-color: var(--white);
    }

    .btn-white:hover {
        background: transparent;
        color: var(--white);
        border-color: var(--white);
    }

    /* Info Grid */
    .info-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-light);
    }

    .info-item i {
        color: var(--primary-color);
        width: 1rem;
        text-align: center;
    }

    /* Gallery Section */
    .gallery-container {
        display: flex;
        gap: 1rem;
        overflow-x: auto;
        padding: 1rem 0;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .gallery-container::-webkit-scrollbar {
        display: none;
    }

    .gallery-item {
        flex: 0 0 280px;
        height: 200px;
        border-radius: 0.75rem;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .gallery-item:hover {
        transform: scale(1.05);
    }

    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Full Width Gallery */
    .gallery-container-full {
        display: flex;
        gap: 1.5rem;
        overflow-x: auto;
        padding: 1rem 2rem;
        scrollbar-width: none;
        -ms-overflow-style: none;
        scroll-behavior: smooth;
    }

    .gallery-container-full::-webkit-scrollbar {
        display: none;
    }

    .gallery-item-full {
        flex: 0 0 350px;
        height: 250px;
        border-radius: 1rem;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        box-shadow: var(--shadow-md);
    }

    @media (min-width: 768px) {
        .gallery-item-full {
            flex: 0 0 400px;
            height: 280px;
        }
    }

    @media (min-width: 1024px) {
        .gallery-item-full {
            flex: 0 0 450px;
            height: 320px;
        }
    }

    .gallery-item-full:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
    }

    .gallery-item-full img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .gallery-item-full:hover img {
        transform: scale(1.05);
    }

    .gallery-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.8));
        color: var(--white);
        padding: 1.5rem 1rem 1rem;
        transform: translateY(100%);
        transition: transform 0.3s ease;
    }

    .gallery-item-full:hover .gallery-caption {
        transform: translateY(0);
    }

    .gallery-caption p {
        margin: 0;
        font-size: 0.875rem;
        font-weight: 500;
    }

    /* Amenities Grid */
    .amenity-card {
        text-align: center;
        padding: 1rem;
        background: var(--white);
        border-radius: 0.75rem;
        border: 1px solid var(--border-light);
        transition: all 0.3s ease;
    }

    .amenity-card:hover {
        border-color: var(--primary-color);
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    .amenity-icon {
        width: 3rem;
        height: 3rem;
        background: #fef2f2;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.75rem;
        color: var(--primary-color);
        font-size: 1.125rem;
    }

    .amenity-name {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-dark);
    }

    /* Location Cards */
    .location-card {
        text-align: center;
        padding: 0.75rem;
        background: #f8fafc;
        border-radius: 0.75rem;
        border: 1px solid var(--border-light);
        transition: all 0.3s ease;
    }

    .location-card:hover {
        background: #fef2f2;
        border-color: var(--primary-color);
    }

    .location-marker {
        width: 2.5rem;
        height: 2.5rem;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.5rem;
        color: var(--white);
        font-size: 0.875rem;
    }

    /* Sticky Form */
    .sticky-form {
        position: sticky;
        top: 2rem;
        z-index: 10;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border-light);
        border-radius: 0.5rem;
        background: #f8fafc;
        color: var(--text-dark);
        font-size: 0.875rem;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        background: var(--white);
        box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }

    /* Specifications Table */
    .spec-table {
        background: var(--white);
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: var(--shadow-md);
    }

    .spec-header {
        background: var(--gradient-primary);
        color: var(--white);
        padding: 1rem;
        font-weight: 700;
    }

    .spec-row {
        display: grid;
        grid-template-columns: 1fr 2fr;
        border-bottom: 1px solid var(--border-light);
    }

    .spec-row:last-child {
        border-bottom: none;
    }

    .spec-row:hover {
        background: #fef2f2;
    }

    .spec-cell {
        padding: 0.75rem 1rem;
    }

    .spec-name {
        font-weight: 600;
        color: var(--text-dark);
    }

    .spec-value {
        color: var(--text-light);
    }

    /* Timeline */
    .timeline {
        position: relative;
        padding-left: 2rem;
    }

    .timeline::before {
        content: '';
        position: absolute;
        left: 0.5rem;
        top: 0;
        bottom: 0;
        width: 2px;
        background: var(--primary-color);
    }

    .timeline-item {
        position: relative;
        margin-bottom: 1.5rem;
        background: var(--white);
        border-radius: 0.75rem;
        padding: 1rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-light);
    }

    .timeline-item::before {
        content: '';
        position: absolute;
        left: -1.75rem;
        top: 1rem;
        width: 0.75rem;
        height: 0.75rem;
        border-radius: 50%;
        background: var(--primary-color);
        border: 3px solid var(--white);
        box-shadow: 0 0 0 2px var(--primary-color);
    }

    /* Floor Plans */
    .floor-plan-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        justify-content: center;
    }

    .floor-plan-tab {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .floor-plan-tab.active {
        background: var(--primary-color);
        color: var(--white);
    }

    .floor-plan-tab:not(.active) {
        background: var(--white);
        color: var(--text-dark);
        border: 1px solid var(--border-light);
    }

    .floor-plan-tab:not(.active):hover {
        background: #fef2f2;
        border-color: var(--primary-color);
    }

    .floor-plan-content {
        background: #fef2f2;
        border-radius: 1rem;
        padding: 1.5rem;
    }

    .floor-plan-image-container {
        width: 100%;
        max-width: 600px;
        height: 400px;
        background: #ffffff;
        border-radius: 0.75rem;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .floor-plan-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .floor-plan-image:hover {
        transform: scale(1.05);
    }
    
    @media (max-width: 768px) {
        .floor-plan-image-container {
            height: 300px;
        }
    }

    /* CTA Section */
    .cta-section {
        background: var(--gradient-dark);
        color: var(--white);
        position: relative;
        overflow: hidden;
    }

    .cta-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23dots)"/></svg>');
        opacity: 0.3;
    }

    .cta-content {
        position: relative;
        z-index: 1;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 2rem;
    }

    @media (min-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    .stat-item {
        text-align: center;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        backdrop-filter: blur(10px);
    }

    .stat-number {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--accent-color);
        margin-bottom: 0.25rem;
    }

    @media (min-width: 768px) {
        .stat-number {
            font-size: 2rem;
        }
    }

    .stat-label {
        font-size: 0.875rem;
        opacity: 0.8;
    }

    /* Mobile Responsive Adjustments */
    @media (max-width: 767px) {
        .container-fluid,
        .container {
            padding: 0 0.75rem;
        }

        .section {
            padding: 1.5rem 0;
        }

        .card {
            padding: 1rem;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            font-size: 0.8125rem;
        }

        .gallery-item {
            flex: 0 0 240px;
            height: 160px;
        }

        .gallery-item-full {
            flex: 0 0 280px !important;
            height: 200px !important;
        }

        .gallery-container-full {
            padding: 1rem 1rem;
            gap: 1rem;
        }

        .hero-wrapper {
            min-height: auto;
        }

        .hero-image-container {
            height: 280px;
        }

        .hero-content-container {
            padding: 1.5rem;
        }

        .hero-title {
            font-size: 1.5rem;
        }

        .hero-price {
            font-size: 1.25rem;
        }

        .hero-details-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .detail-item {
            padding: 0.5rem;
        }

        .hero-badges {
            top: 0.75rem;
            left: 0.75rem;
            gap: 0.25rem;
        }

        .hero-badge {
            padding: 0.375rem 0.625rem;
            font-size: 0.625rem;
            font-weight: 600;
        }

        .hero-logo {
            top: 0.75rem;
            right: 0.75rem;
            width: 2.5rem;
            height: 2.5rem;
        }

        .hero-badge.status {
            padding: 0.25rem 0.75rem;
            font-size: 0.625rem;
            top: 0.75rem;
            right: 0.75rem;
        }

        .hero-badge.status ~ .hero-logo {
            top: 2.5rem;
        }

        .title-section {
            font-size: 1.25rem;
        }

        .grid {
            gap: 0.75rem;
        }

        /* Mobile hero section adjustments */
        .hero-section {
            padding: 1rem 0;
            min-height: auto;
        }

        .hero-wrapper {
            border-radius: 1rem;
            min-height: auto;
        }

        .lg\:grid-cols-3 {
            grid-template-columns: 1fr;
        }

        .lg\:col-span-2,
        .lg\:col-span-1 {
            grid-column: span 1;
        }

        /* Stack form on mobile */
        .lg\:col-span-2,
        .lg\:col-span-1 {
            grid-column: span 1;
        }

        /* Mobile-friendly stats grid */
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        /* Smaller amenity cards on mobile */
        .amenity-icon {
            width: 2rem;
            height: 2rem;
            font-size: 0.875rem;
        }

        .amenity-name {
            font-size: 0.6875rem;
        }

        /* Adjust location cards */
        .location-marker {
            width: 2rem;
            height: 2rem;
            font-size: 0.75rem;
        }

        /* Hero content better spacing on mobile */
        .hero-content-inner {
            gap: 1rem;
        }

        /* Improve hero details spacing */
        .hero-details-grid .detail-item {
            font-size: 0.75rem;
        }
    }

    /* Extra small devices (phones, 480px and down) */
    @media (max-width: 480px) {
        .hero-badges {
            top: 0.5rem;
            left: 0.5rem;
            flex-direction: row;
            flex-wrap: wrap;
            max-width: calc(100% - 4rem);
        }

        .hero-badge {
            padding: 0.25rem 0.5rem;
            font-size: 0.5rem;
            white-space: nowrap;
        }

        .hero-logo {
            top: 0.5rem;
            right: 0.5rem;
            width: 2rem;
            height: 2rem;
        }

        .hero-badge.status {
            position: relative;
            top: auto;
            right: auto;
            margin-bottom: 0.25rem;
        }

        .hero-title {
            font-size: 1.25rem;
            line-height: 1.2;
        }

        .hero-price {
            font-size: 1.125rem;
        }
    }

    /* Tablet Adjustments */
    @media (min-width: 768px) and (max-width: 1023px) {
        .hero-image {
            height: 350px;
        }

        .gallery-item {
            flex: 0 0 260px;
            height: 180px;
        }
    }

    /* Large screen optimizations */
    @media (min-width: 1280px) {
        .container {
            max-width: 1200px;
        }

        .gallery-item {
            flex: 0 0 320px;
            height: 220px;
        }
    }

    /* Animation Classes */
    .fade-in {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .fade-in.visible {
        opacity: 1;
        transform: translateY(0);
    }

    /* Map Container */
    .map-container {
        height: 300px;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-light);
    }

    @media (min-width: 768px) {
        .map-container {
            height: 400px;
        }
    }

    /* Badge Styles */
    .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    .badge-premium {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: var(--white);
    }

    .badge-featured {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: var(--white);
    }

    .badge-hot {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        color: var(--white);
    }

    .badge-developer {
        background: #fef2f2;
        color: var(--primary-color);
        border: 1px solid #fecaca;
    }

    /* Loading Animation */
    .loading-spinner {
        display: inline-block;
        width: 1rem;
        height: 1rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--white);
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    @keyframes highlight-pulse {
        0%, 100% { 
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
        }
        50% { 
            box-shadow: 0 0 0 10px rgba(239, 68, 68, 0.3);
        }
    }

    /* Utility Classes */
    .text-center { text-align: center; }
    .text-left { text-align: left; }
    .text-right { text-align: right; }
    .mb-0 { margin-bottom: 0; }
    .mb-1 { margin-bottom: 0.5rem; }
    .mb-2 { margin-bottom: 1rem; }
    .mb-3 { margin-bottom: 1.5rem; }
    .mt-2 { margin-top: 1rem; }
    .pt-2 { padding-top: 1rem; }
    .pb-2 { padding-bottom: 1rem; }
    .hidden { display: none; }
    .block { display: block; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: 1rem; }
    .gap-3 { gap: 1.5rem; }
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    
    /* Modal Styles */
    #floor-plan-modal {
        background-color: rgba(0, 0, 0, 0.5) !important;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 60;
        display: none;
        align-items: center;
        justify-content: center;
    }
    
    #floor-plan-modal.show {
        display: flex !important;
    }
    
    /* Image Modal Styles */
    #image-modal {
        background-color: rgba(0, 0, 0, 0.95) !important;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 70;
        display: none;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease-in-out;
    }
    
    #image-modal.show {
        display: flex !important;
    }
    
    #modal-image {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        user-select: none;
        -webkit-user-drag: none;
    }
    
    #image-container {
        cursor: move;
    }
    
    #image-container.zoomed {
        cursor: grab;
    }
    
    #image-container.zoomed:active {
        cursor: grabbing;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Main Container -->
<div class="min-h-screen">

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container-fluid">
            <div class="hero-wrapper">
                
                <!-- Left: Hero Image (55% width) -->
                <div class="hero-image-container">
                    <div class="hero-image-main">
                        {% if project.banner_image %}
                            <img src="{{ project.banner_image.url }}" alt="{{ project.name }}" loading="eager">
                        {% elif project.gallery_images.first %}
                            <img src="{{ project.gallery_images.first.image.url }}" alt="{{ project.name }}" loading="eager">
                        {% else %}
                            <img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=800&h=600&fit=crop" alt="{{ project.name }}" loading="eager">
                        {% endif %}
                        

                        
                        <!-- Developer Logo -->
                        {% if project.logo %}
                        <div class="hero-logo">
                            <img src="{{ project.logo.url }}" alt="{{ project.project_by }}">
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Right: Project Info (45% width) -->
                <div class="hero-content-container">
                    <div class="hero-content-inner">
                        
                        <!-- Developer Name -->
                        {% if project.project_by %}
                        <div class="developer-tag">
                            BY {{ project.project_by|upper }}
                        </div>
                        {% endif %}
                        
                        <!-- Project Name -->
                        <h1 class="hero-title">{{ project.name }}</h1>
                        
                        <!-- Price -->
                        {% if project.onwards_price %}
                        <div class="hero-price">
                            Starting from ₹{{ project.onwards_price|format_price }}
                        </div>
                        {% endif %}
                        
                        <!-- Reviews Summary -->
                        {% if project.approved_reviews_count %}
                        <div class="hero-reviews mt-2 flex items-center gap-3">
                            <div class="flex items-center text-yellow-400">
                                <i class="fas fa-star mr-2"></i>
                                <span class="font-semibold">{{ project.average_rating|floatformat:1 }}</span>
                            </div>
                            <div class="text-sm text-gray-300">•</div>
                            <div class="text-sm text-gray-300">{{ project.approved_reviews_count }} Reviews</div>
                        </div>
                        {% endif %}

                        <div class="hero-cta-text">Contact us for more exciting details!</div>
                        
                        <!-- Project Details Grid -->
                        <div class="hero-details-grid">
                            <!-- Location -->
                            {% if project.location or project.city %}
                            <div class="detail-item location">
                                <i class="fas fa-map-marker-alt"></i>
                                <div class="detail-content">
                                    <span class="detail-label">Location</span>
                                    <span class="detail-value">{{ project.location|default:project.city }}</span>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Developer Info -->
                            {% if project.developers or project.project_by %}
                            <div class="detail-item developer">
                                <i class="fas fa-building"></i>
                                <div class="detail-content">
                                    <span class="detail-label">Developer</span>
                                    <span class="detail-value">{{ project.developers|default:project.project_by }}</span>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- BHK Configuration -->
                            {% if project.bhk %}
                            <div class="detail-item bhk">
                                <i class="fas fa-home"></i>
                                <div class="detail-content">
                                    <span class="detail-label">Configuration</span>
                                    <span class="detail-value">{{ project.bhk }}</span>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Area -->
                            {% if project.build_up_area %}
                            <div class="detail-item area">
                                <i class="fas fa-ruler-combined"></i>
                                <div class="detail-content">
                                    <span class="detail-label">Super Built Up</span>
                                    <span class="detail-value">{{ project.build_up_area }}</span>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Total Land Area -->
                            {% if project.total_area %}
                            <div class="detail-item land-area">
                                <i class="fas fa-expand-arrows-alt"></i>
                                <div class="detail-content">
                                    <span class="detail-label">Land Area</span>
                                    <span class="detail-value">{{ project.total_area }}</span>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Number of Units -->
                            {% if project.no_of_units %}
                            <div class="detail-item units">
                                <i class="fas fa-building"></i>
                                <div class="detail-content">
                                    <span class="detail-label">No of Units</span>
                                    <span class="detail-value">{{ project.no_of_units }}</span>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Status and Dates Row -->
                        <div class="hero-status-row">
                            <!-- Status -->
                            <div class="status-section">
                                <div class="status-header">STATUS</div>
                                <div class="status-value">{{ project.get_status_display|default:"Under Construction" }}</div>
                            </div>
                            
                            <!-- Possession Date -->
                            {% if project.possession_date %}
                            <div class="status-section">
                                <div class="status-header">POSSESSION DATE</div>
                                <div class="status-value possession-date">{{ project.possession_date|date:"M Y" }}</div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- RERA Number -->
                        {% if project.rera_number %}
                        <div class="rera-section">
                            <div class="rera-header">RERA ID(S)</div>
                            <div class="rera-value">{{ project.rera_number }}</div>
                        </div>
                        {% endif %}
                        
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Full Width Gallery Section -->
    {% if project.gallery_images.all %}
    <section class="section fade-in" style="background: var(--white); border-top: 1px solid var(--border-light); border-bottom: 1px solid var(--border-light);">
        <div class="container">
            <div class="flex justify-between items-center mb-4">
                <h2 class="title-section mb-0">Visual Gallery</h2>
                <div class="flex gap-2">
                    <button id="gallery-prev" class="btn btn-primary" style="padding: 0.75rem;">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="gallery-next" class="btn btn-primary" style="padding: 0.75rem;">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Full Width Gallery Container -->
        <div class="gallery-container-full" id="gallery-scroll">
            {% for image in project.gallery_images.all %}
            <div class="gallery-item-full" onclick="openImageModal('{{ image.image.url }}', '{{ image.caption|default:project.name }}')">
                <img src="{{ image.image.url }}" alt="{{ image.caption|default:project.name }}" loading="lazy">
                {% if image.caption %}
                <div class="gallery-caption">
                    <p>{{ image.caption }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Main Content with Sticky Form Layout -->
    <div class="container">
        <div class="grid lg:grid-cols-3 gap-3">
            
            <!-- Left Content (2/3 width) -->
            <div class="lg:col-span-2 space-y-6">

                <!-- About Project -->
                {% if project.description %}
                <section class="card fade-in">
                    <h2 class="title-section">About {{ project.name }}</h2>
                    <div class="text-gray-700 leading-relaxed">
                        {{ project.description|linebreaks }}
                    </div>
                </section>
                {% endif %}

                <!-- Amenities -->
                {% if project.amenities.all %}
                <section class="card fade-in">
                    <h2 class="title-section">Amenities & Facilities</h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                        {% for amenity in project.amenities.all %}
                        <div class="amenity-card">
                            <div class="amenity-icon">
                                {% if amenity.icon %}
                                    <img src="{{ amenity.icon.url }}" alt="{{ amenity.name }}" class="w-5 h-5">
                                {% else %}
                                    <i class="fas fa-star"></i>
                                {% endif %}
                            </div>
                            <div class="amenity-name">{{ amenity.name }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
                {% endif %}

                <!-- Location & Connectivity -->
                <section class="card fade-in">
                    <h2 class="title-section">Location & Connectivity</h2>
                    
                    <!-- Map -->
                    {% if project.latitude and project.longitude %}
                    <div class="map-container mb-3" id="map" 
                         data-lat="{{ project.latitude }}" 
                         data-lng="{{ project.longitude }}" 
                         data-title="{{ project.name }}">
                    </div>
                    {% endif %}
                    
                    <!-- Nearby Places -->
                    {% if project.nearest_areas.all %}
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 mt-3">
                        {% for area in project.nearest_areas.all %}
                        <div class="location-card">
                            <div class="location-marker">
                                {% if area.icon %}
                                    <img src="{{ area.icon.url }}" alt="{{ area.get_area_type_display }}" class="w-4 h-4">
                                {% else %}
                                    <i class="fas fa-map-marker-alt"></i>
                                {% endif %}
                            </div>
                            <div class="font-semibold text-xs mb-1">{{ area.name }}</div>
                            {% if area.distance %}
                            <div class="text-xs text-gray-600">{{ area.distance }}</div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </section>

                <!-- Floor Plans -->
                {% if project.floor_plans.all %}
                <section id="floor-plans-section" class="card fade-in">
                    <h2 class="title-section">Floor Plans</h2>
                    
                    <div class="floor-plan-tabs">
                        {% for plan in project.floor_plans.all %}
                        <button class="floor-plan-tab {% if forloop.first %}active{% endif %}" 
                                data-plan="{{ forloop.counter }}">
                            {{ plan.name }}
                        </button>
                        {% endfor %}
                    </div>
                    
                    {% for plan in project.floor_plans.all %}
                    <div id="floor-plan-{{ forloop.counter }}" class="floor-plan-item {% if not forloop.first %}hidden{% endif %}">
                        <div class="floor-plan-content">
                            <div class="grid lg:grid-cols-2 gap-6 items-center">
                                <div class="flex justify-center">
                                    {% if plan.image %}
                                        {% if has_floor_plan_access %}
                                            <div class="floor-plan-image-container">
                                                <img src="{{ plan.image.url }}" 
                                                     alt="{{ plan.name }}" 
                                                     class="floor-plan-image"
                                                     onclick="openImageModal('{{ plan.image.url }}', '{{ plan.name }}')">
                                            </div>
                                        {% else %}
                                            <div class="floor-plan-image-container relative">
                                                <img src="{{ plan.image.url }}" 
                                                     alt="{{ plan.name }}" 
                                                     class="floor-plan-image blur-md">
                                                <div class="absolute inset-0 bg-black bg-opacity-60 rounded-lg flex items-center justify-center">
                                                    <div class="text-center text-white p-6">
                                                        <i class="fas fa-lock text-4xl mb-3"></i>
                                                        <p class="font-bold text-lg mb-2">Floor Plan Locked</p>
                                                        <p class="text-sm text-gray-300">Fill the form to access</p>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                                <div class="space-y-4">
                                    <h3 class="text-2xl font-bold text-gray-900">{{ plan.name }}</h3>
                                    {% if plan.area %}
                                    <div class="flex items-center text-gray-700 bg-white rounded-lg p-3 shadow-sm">
                                        <i class="fas fa-ruler-combined mr-3 text-red-600 text-xl"></i>
                                        <div>
                                            <p class="text-xs text-gray-500">Area</p>
                                            <span class="font-semibold text-lg">{{ plan.area }}</span>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% if plan.price %}
                                    <div class="flex items-center text-gray-700 bg-white rounded-lg p-3 shadow-sm">
                                        <i class="fas fa-tag mr-3 text-red-600 text-xl"></i>
                                        <div>
                                            <p class="text-xs text-gray-500">Price</p>
                                            <span class="font-bold text-xl text-red-600">₹{{ plan.price|format_price }}</span>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% if not has_floor_plan_access %}
                                    <button type="button" onclick="openFloorPlanModal(); return false;" class="btn btn-primary w-full">
                                        <i class="fas fa-unlock mr-2"></i>Get Access to Floor Plans
                                    </button>
                                    <p class="text-xs text-gray-500 text-center">Submit your details to view full floor plans</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </section>
                {% endif %}

                <!-- Specifications -->
                {% if project.specifications.all %}
                <section class="card fade-in">
                    <h2 class="title-section">Specifications</h2>
                    <div class="spec-table">
                        {% regroup project.specifications.all by category as spec_categories %}
                        {% for category in spec_categories %}
                        <div class="spec-header">
                            <i class="fas fa-cog mr-2"></i>{{ category.grouper.name }}
                        </div>
                        {% for spec in category.list %}
                        <div class="spec-row">
                            <div class="spec-cell spec-name">
                                <i class="fas fa-check-circle text-red-500 mr-2"></i>{{ spec.name }}
                            </div>
                            <div class="spec-cell spec-value">{{ spec.description }}</div>
                        </div>
                        {% endfor %}
                        {% endfor %}
                    </div>
                </section>
                {% endif %}

                <!-- Why Choose Us & Construction Updates -->
                <div class="grid lg:grid-cols-2 gap-3">
                    
                    <!-- Why Choose Us -->
                    {% if project.why_choose_us.all %}
                    <section class="card fade-in">
                        <h2 class="text-lg font-bold mb-3">Why Choose {{ project.name }}?</h2>
                        <div class="space-y-3">
                            {% for point in project.why_choose_us.all %}
                            <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                                {% if point.icon %}
                                <div class="flex-shrink-0 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                    <i class="{{ point.icon }} text-red-600 text-sm"></i>
                                </div>
                                {% endif %}
                                <div>
                                    <h3 class="font-semibold text-sm">{{ point.title }}</h3>
                                    {% if point.description %}
                                    <p class="text-xs text-gray-600 mt-1">{{ point.description }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </section>
                    {% endif %}
                    
                    <!-- Construction Updates -->
                    {% if project.construction_updates.all %}
                    <section class="card fade-in">
                        <h2 class="text-lg font-bold mb-3">Construction Progress</h2>
                        <div class="timeline">
                            {% for update in project.construction_updates.all %}
                            <div class="timeline-item">
                                {% if update.image %}
                                <div class="mb-2">
                                    <img src="{{ update.image.url }}" alt="{{ update.title }}" 
                                         class="w-full h-24 object-cover rounded-lg">
                                </div>
                                {% endif %}
                                <div class="flex justify-between items-start mb-1">
                                    {% if update.title %}
                                    <h3 class="font-semibold text-sm">{{ update.title }}</h3>
                                    {% endif %}
                                    <span class="text-xs text-red-600 bg-red-50 px-2 py-1 rounded-full">
                                        {{ update.update_date|date:"M d, Y" }}
                                    </span>
                                </div>
                                {% if update.description %}
                                <p class="text-xs text-gray-600">{{ update.description }}</p>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </section>
                    {% endif %}
                </div>

            </div>

            <!-- Right Sticky Form (1/3 width) -->
            <div class="lg:col-span-1">
                <div class="sticky-form">
                    <div class="card" id="inquiry-form">
                        <h3 class="text-lg font-bold mb-2 text-center">Quick Inquiry</h3>
                        <form id="project-inquiry-form" class="space-y-2">
                            {% csrf_token %}
                            <input type="hidden" name="project_slug" value="{{ project.slug }}">
                            
                            <div class="form-group">
                                <input type="text" name="name" placeholder="Your Name *" 
                                       class="form-input text-sm py-2" required>
                            </div>
                            
                            <div class="form-group">
                                <input type="email" name="email" placeholder="Email Address *" 
                                       class="form-input text-sm py-2" required>
                            </div>
                            
                            <div class="form-group">
                                <input type="tel" name="phone" placeholder="Phone Number *" 
                                       class="form-input text-sm py-2" required>
                            </div>
                            
                            <div class="form-group">
                                <select name="interest" id="interest-select" class="form-input text-sm py-2">
                                    <option value="">I'm interested in</option>
                                    <option value="buying">Buying</option>
                                    <option value="investment">Investment</option>
                                    <option value="site_visit">Schedule Site Visit</option>
                                    <option value="floor_plans">Floor Plans</option>
                                    <option value="pricing">Pricing Details</option>
                                </select>
                            </div>
                            
                            <!-- Appointment Date & Time Fields (shown when site visit is selected) -->
                            <div id="appointment-fields" style="display: none;" class="p-2 bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded mt-2">
                                <p class="text-xs font-semibold text-blue-900 mb-2 flex items-center">
                                    <i class="fas fa-calendar-check mr-1"></i>Select Date & Time
                                </p>
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <input type="date" name="appointment_date" 
                                               class="form-input text-xs py-1.5 w-full" 
                                               min="{{ today_date|date:'Y-m-d' }}"
                                               placeholder="Date">
                                    </div>
                                    <div>
                                        <select name="appointment_time" class="form-input text-xs py-1.5 w-full">
                                            <option value="">Time</option>
                                            <option value="09:00 AM">09:00 AM</option>
                                            <option value="10:00 AM">10:00 AM</option>
                                            <option value="11:00 AM">11:00 AM</option>
                                            <option value="12:00 PM">12:00 PM</option>
                                            <option value="01:00 PM">01:00 PM</option>
                                            <option value="02:00 PM">02:00 PM</option>
                                            <option value="03:00 PM">03:00 PM</option>
                                            <option value="04:00 PM">04:00 PM</option>
                                            <option value="05:00 PM">05:00 PM</option>
                                            <option value="06:00 PM">06:00 PM</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <textarea name="message" rows="2" placeholder="Your Message" 
                                          class="form-input resize-none text-sm py-2"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full text-sm py-2">
                                <i class="fas fa-paper-plane mr-2"></i>
                                <span>Send Inquiry</span>
                            </button>
                        </form>
                        
                        <!-- Contact Info -->
                        <div class="mt-4 pt-3 border-t border-gray-200">
                            <h4 class="font-semibold mb-2 text-center text-sm">Direct Contact</h4>
                            <div class="space-y-2 text-center">
                                {% if project.contact_phone %}
                                <a href="tel:{{ project.contact_phone }}" 
                                   class="flex items-center justify-center text-red-600 hover:text-red-800 text-sm">
                                    <i class="fas fa-phone mr-2"></i>{{ project.contact_phone }}
                                </a>
                                {% endif %}
                                {% if project.contact_email %}
                                <a href="mailto:{{ project.contact_email }}" 
                                   class="flex items-center justify-center text-red-600 hover:text-red-800 text-sm">
                                    <i class="fas fa-envelope mr-2"></i>{{ project.contact_email }}
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    {% if project.approved_reviews_count > 0 %}
    <section class="section bg-gradient-to-r from-gray-50 to-white">
        <div class="container">
            <div class="section-header text-center mb-12">
                <h2 class="title-section text-3xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-comments text-red-600 mr-3"></i>Customer Reviews
                </h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg">
                    Hear from {{ project.approved_reviews_count }} satisfied customer{{ project.approved_reviews_count|pluralize }} who chose {{ project.name }}
                </p>
                <div class="flex items-center justify-center mt-4">
                    <div class="flex items-center">
                        {% for i in "12345"|make_list %}
                            <i class="fas fa-star text-yellow-400 text-xl"></i>
                        {% endfor %}
                    </div>
                    <span class="ml-3 text-gray-700 font-semibold">{{ project.average_rating|floatformat:1 }}/5 Average Rating</span>
                </div>
            </div>

            <!-- Horizontal Scrollable Reviews -->
            <div class="relative">
                <div class="reviews-carousel overflow-x-auto pb-6 scrollbar-hide">
                    <div class="flex gap-6 w-max">
                        {% for review in project.approved_reviews %}
                        <div class="review-card bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border-l-4 border-red-500 w-96 flex-shrink-0">
                            <div class="flex items-center mb-6">
                                <div class="review-avatar bg-gradient-to-br from-red-500 to-red-600 text-white rounded-full w-14 h-14 flex items-center justify-center font-bold text-xl shadow-lg">
                                    {{ review.reviewer_name|first|upper }}
                                </div>
                                <div class="ml-4 flex-1">
                                    <h4 class="font-bold text-gray-900 text-lg">{{ review.reviewer_name }}</h4>
                                    <p class="text-sm text-gray-500 mb-2">Verified Customer</p>
                                    <div class="flex items-center">
                                        {% for i in "12345"|make_list %}
                                            {% if forloop.counter <= review.rating %}
                                                <i class="fas fa-star text-yellow-400 text-lg"></i>
                                            {% else %}
                                                <i class="far fa-star text-gray-300 text-lg"></i>
                                            {% endif %}
                                        {% endfor %}
                                        <span class="text-sm text-gray-600 ml-2 font-medium">({{ review.rating }}/5)</span>
                                    </div>
                                </div>
                            </div>
                            
                            <blockquote class="text-gray-700 text-base leading-relaxed mb-6 relative">
                                <i class="fas fa-quote-left text-red-200 text-2xl absolute -top-2 -left-1"></i>
                                <span class="pl-8">{{ review.comment }}</span>
                                <i class="fas fa-quote-right text-red-200 text-2xl absolute -bottom-2 right-0"></i>
                            </blockquote>
                            
                            <div class="flex items-center justify-between text-sm text-gray-500 pt-4 border-t border-gray-100">
                                <span class="flex items-center">
                                    <i class="far fa-calendar-alt mr-2"></i>
                                    {{ review.created_at|date:"M j, Y" }}
                                </span>
                                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium">
                                    <i class="fas fa-check-circle mr-1"></i>Verified Review
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Navigation Arrows -->
                {% if project.approved_reviews_count > 3 %}
                <button id="reviews-scroll-left" class="absolute left-0 top-1/2 -translate-y-1/2 bg-white shadow-lg rounded-full w-12 h-12 flex items-center justify-center text-gray-700 hover:bg-red-600 hover:text-white transition-all duration-300 z-10 opacity-0 group-hover:opacity-100">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button id="reviews-scroll-right" class="absolute right-0 top-1/2 -translate-y-1/2 bg-white shadow-lg rounded-full w-12 h-12 flex items-center justify-center text-gray-700 hover:bg-red-600 hover:text-white transition-all duration-300 z-10">
                    <i class="fas fa-chevron-right"></i>
                </button>
                {% endif %}
            </div>
            
            <!-- Scroll Indicators -->
            <div class="flex justify-center space-x-2 mt-8">
                {% for review in project.approved_reviews %}
                    <div class="review-indicator w-2 h-2 bg-gray-300 rounded-full transition-all duration-300 cursor-pointer hover:bg-red-400" data-index="{{ forloop.counter0 }}"></div>
                {% endfor %}
            </div>
            
            <style>
                .reviews-carousel {
                    -webkit-overflow-scrolling: touch;
                    scroll-behavior: smooth;
                }
                
                .scrollbar-hide {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }
                
                .scrollbar-hide::-webkit-scrollbar {
                    display: none;
                }
                
                #reviews-scroll-left,
                #reviews-scroll-right {
                    transition: opacity 0.3s ease;
                }
                
                .section:hover #reviews-scroll-left,
                .section:hover #reviews-scroll-right {
                    opacity: 1;
                }
            </style>
            
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const carousel = document.querySelector('.reviews-carousel');
                    const leftBtn = document.getElementById('reviews-scroll-left');
                    const rightBtn = document.getElementById('reviews-scroll-right');
                    const indicators = document.querySelectorAll('.review-indicator');
                    
                    if (!carousel) return;
                    
                    const cardWidth = 384 + 24; // w-96 (384px) + gap-6 (24px)
                    
                    // Scroll functions
                    function scrollLeft() {
                        carousel.scrollBy({ left: -cardWidth, behavior: 'smooth' });
                    }
                    
                    function scrollRight() {
                        carousel.scrollBy({ left: cardWidth, behavior: 'smooth' });
                    }
                    
                    // Button event listeners
                    if (leftBtn) leftBtn.addEventListener('click', scrollLeft);
                    if (rightBtn) rightBtn.addEventListener('click', scrollRight);
                    
                    // Update indicators based on scroll position
                    function updateIndicators() {
                        const scrollLeft = carousel.scrollLeft;
                        const currentIndex = Math.round(scrollLeft / cardWidth);
                        
                        indicators.forEach((indicator, index) => {
                            if (index === currentIndex) {
                                indicator.classList.remove('bg-gray-300');
                                indicator.classList.add('bg-red-600', 'w-8');
                            } else {
                                indicator.classList.remove('bg-red-600', 'w-8');
                                indicator.classList.add('bg-gray-300');
                            }
                        });
                        
                        // Show/hide navigation buttons
                        if (leftBtn) {
                            leftBtn.style.opacity = scrollLeft > 0 ? '1' : '0';
                        }
                    }
                    
                    // Indicator click handlers
                    indicators.forEach((indicator, index) => {
                        indicator.addEventListener('click', () => {
                            carousel.scrollTo({
                                left: index * cardWidth,
                                behavior: 'smooth'
                            });
                        });
                    });
                    
                    // Scroll event listener
                    carousel.addEventListener('scroll', updateIndicators);
                    
                    // Initialize
                    updateIndicators();
                    
                    // Keyboard navigation
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'ArrowLeft') scrollLeft();
                        if (e.key === 'ArrowRight') scrollRight();
                    });
                });
            </script>

            {% if project.approved_reviews_count > 6 %}
            <div class="text-center mt-12">
                <div class="bg-gray-100 rounded-lg p-6 max-w-md mx-auto">
                    <p class="text-gray-700 font-medium mb-2">
                        <i class="fas fa-users text-red-600 mr-2"></i>
                        Showing first 6 of {{ project.approved_reviews_count }} reviews
                    </p>
                    <p class="text-sm text-gray-500">
                        More happy customers have shared their experiences
                    </p>
                </div>
            </div>
            {% endif %}

            {% if project.approved_reviews_count == 0 %}
            <div class="text-center py-12">
                <div class="bg-gray-50 rounded-xl p-8 max-w-md mx-auto">
                    <i class="fas fa-star-half-alt text-gray-400 text-4xl mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">No Reviews Yet</h3>
                    <p class="text-gray-500">Be the first to share your experience with {{ project.name }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </section>
    {% endif %}

    <!-- CTA Section -->
    <section class="cta-section section">
        <div class="cta-content">
            <div class="container text-center">
                <h2 class="text-2xl md:text-4xl font-bold mb-4">
                    Your Dream Home Awaits at <span class="text-yellow-400">{{ project.name }}</span>
                </h2>
                <p class="text-lg mb-6 opacity-90 max-w-2xl mx-auto">
                    Experience luxury living with world-class amenities and prime location. 
                    Join hundreds of satisfied homeowners who chose {{ project.name }}.
                </p>
                
                <div class="flex flex-wrap gap-3 justify-center">
                    <button onclick="scrollToForm()" class="btn btn-white">
                        <i class="fas fa-calendar mr-2"></i>Schedule Visit
                    </button>
                    {% if project.brochure %}
                    <a href="{{ project.brochure.url }}" target="_blank" class="btn btn-secondary text-white border-white">
                        <i class="fas fa-download mr-2"></i>Download Brochure
                    </a>
                    {% endif %}
                </div>
                
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ project.views|default:"500" }}+</div>
                        <div class="stat-label">Views</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ project.amenities.count|default:"25" }}+</div>
                        <div class="stat-label">Amenities</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">99%</div>
                        <div class="stat-label">Satisfaction</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Support</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Projects -->
    {% if related_projects %}
    <section class="section" style="background: var(--light-gray);">
        <div class="container">
            <h2 class="title-section">Similar Properties</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-5">
                {% for project in related_projects %}
                    {% include 'components/unified_property_card.html' with project=project show_amenities=False %}
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

</div>

<!-- Image Modal -->
<!-- Enhanced Image Lightbox Modal -->
<div id="image-modal" class="fixed inset-0 bg-black bg-opacity-95 z-[70]" style="display: none; align-items: center; justify-content: center;">
    <div class="relative w-full h-full flex items-center justify-center p-4">
        <!-- Close Button -->
        <button type="button" onclick="closeImageModal()" 
                class="absolute top-4 right-4 bg-white hover:bg-gray-100 text-black w-12 h-12 rounded-full flex items-center justify-center z-20 transition-all duration-300 shadow-lg">
            <i class="fas fa-times text-xl"></i>
        </button>
        
        <!-- Image Title/Caption -->
        <div id="modal-caption" class="absolute top-4 left-4 bg-black bg-opacity-70 text-white px-6 py-3 rounded-lg z-20 backdrop-blur-sm">
            <p class="font-semibold text-lg"></p>
        </div>
        
        <!-- Help Instructions (shows briefly on open) -->
        <div id="modal-help" class="absolute top-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-80 text-white px-6 py-3 rounded-lg z-20 backdrop-blur-sm transition-opacity duration-500" style="opacity: 0;">
            <div class="text-sm text-center">
                <p><i class="fas fa-mouse-pointer mr-2"></i>Double-click to zoom | Scroll to zoom | Drag to pan</p>
                <p class="mt-1"><i class="fas fa-keyboard mr-2"></i>ESC to close | +/- to zoom | 0 to reset</p>
            </div>
        </div>
        
        <!-- Zoom Controls -->
        <div class="absolute bottom-4 right-4 flex gap-2 z-20">
            <button type="button" onclick="zoomIn()" title="Zoom In (+)"
                    class="bg-white hover:bg-gray-100 text-black w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg">
                <i class="fas fa-search-plus"></i>
            </button>
            <button type="button" onclick="zoomOut()" title="Zoom Out (-)"
                    class="bg-white hover:bg-gray-100 text-black w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg">
                <i class="fas fa-search-minus"></i>
            </button>
            <button type="button" onclick="resetZoom()" title="Reset Zoom (0)"
                    class="bg-white hover:bg-gray-100 text-black w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg">
                <i class="fas fa-redo"></i>
            </button>
        </div>
        
        <!-- Download Button -->
        <a id="download-image" href="" download class="absolute bottom-4 left-4 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full flex items-center gap-2 transition-all duration-300 shadow-lg z-20">
            <i class="fas fa-download"></i>
            <span>Download</span>
        </a>
        
        <!-- Image Container with Pan & Zoom -->
        <div id="image-container" class="relative max-w-7xl max-h-full overflow-hidden">
            <img id="modal-image" src="" alt="" class="max-w-full max-h-[90vh] object-contain transition-transform duration-300 select-none">
        </div>
        
        <!-- Loading Spinner -->
        <div id="modal-loading" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 z-10" style="display: none;">
            <div class="flex flex-col items-center gap-4">
                <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white"></div>
                <p class="text-white text-sm">Loading floor plan...</p>
            </div>
        </div>
    </div>
</div>

<!-- Floor Plan Access Modal -->
<div id="floor-plan-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[60] hidden p-4" style="display: none; align-items: center; justify-content: center;">
    <div class="bg-white rounded-xl max-w-md w-full shadow-xl">
        <div class="flex justify-between items-center p-6 border-b border-gray-200">
            <div>
                <h3 class="text-xl font-bold text-gray-900">Access Floor Plans</h3>
                <p class="text-sm text-gray-600 mt-1">Fill the form to unlock floor plan images</p>
            </div>
            <button onclick="closeFloorPlanModal()" class="text-gray-500 hover:text-gray-700 text-xl" type="button">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="floor-plan-access-form" class="p-6 space-y-4">
            {% csrf_token %}
            <input type="hidden" name="project_slug" value="{{ project.slug }}">
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-blue-600 mt-1 mr-3"></i>
                    <div class="text-sm text-blue-800">
                        <p class="font-semibold mb-1">How it works:</p>
                        <p>Submit your details and the floor plan images will be visible immediately after form submission.</p>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="block text-sm font-semibold mb-2 text-gray-700">Your Name *</label>
                <input type="text" name="name" placeholder="Enter your name" class="form-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" required>
            </div>
            
            <div class="form-group">
                <label class="block text-sm font-semibold mb-2 text-gray-700">Email Address *</label>
                <input type="email" name="email" placeholder="Enter your email" class="form-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" required>
            </div>
            
            <div class="form-group">
                <label class="block text-sm font-semibold mb-2 text-gray-700">Phone Number *</label>
                <input type="tel" name="phone" placeholder="Enter your phone number" class="form-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" required>
            </div>
            
            <div class="form-group">
                <label class="block text-sm font-semibold mb-2 text-gray-700">Message (Optional)</label>
                <textarea name="message" placeholder="Any specific questions about floor plans?" class="form-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none" rows="3"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-unlock mr-2"></i>Submit & View Floor Plans
            </button>
            
            <p class="text-xs text-gray-500 text-center mt-2">
                <i class="fas fa-lock mr-1"></i>Your information is secure and will only be used to contact you about this property.
            </p>
        </form>
    </div>
</div>

<script>
// DOM Ready
document.addEventListener('DOMContentLoaded', function() {
    
    // Check if we should scroll to floor plans section after reload
    if (sessionStorage.getItem('scrollToFloorPlans') === 'true') {
        sessionStorage.removeItem('scrollToFloorPlans');
        
        // Wait a bit for page to fully load, then scroll
        setTimeout(() => {
            const floorPlansSection = document.getElementById('floor-plans-section');
            if (floorPlansSection) {
                floorPlansSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                
                // Add a highlight animation
                floorPlansSection.style.animation = 'highlight-pulse 2s ease-in-out';
            }
        }, 500);
    }
    
    // Fade in animation
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, observerOptions);
    
    document.querySelectorAll('.fade-in').forEach(el => {
        observer.observe(el);
    });
    
    // Gallery Navigation
    const galleryContainer = document.getElementById('gallery-scroll');
    const prevBtn = document.getElementById('gallery-prev');
    const nextBtn = document.getElementById('gallery-next');
    
    if (galleryContainer && prevBtn && nextBtn) {
        const isMobile = window.innerWidth < 768;
        const scrollAmount = isMobile ? 350 : 450;
        
        prevBtn.addEventListener('click', () => {
            galleryContainer.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        });
        
        nextBtn.addEventListener('click', () => {
            galleryContainer.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        });
        
        // Auto-scroll functionality (optional)
        let autoScrollInterval;
        
        function startAutoScroll() {
            autoScrollInterval = setInterval(() => {
                const maxScroll = galleryContainer.scrollWidth - galleryContainer.clientWidth;
                if (galleryContainer.scrollLeft >= maxScroll) {
                    galleryContainer.scrollTo({ left: 0, behavior: 'smooth' });
                } else {
                    galleryContainer.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                }
            }, 5000); // Auto-scroll every 5 seconds
        }
        
        function stopAutoScroll() {
            clearInterval(autoScrollInterval);
        }
        
        // Start auto-scroll
        startAutoScroll();
        
        // Pause auto-scroll on hover
        galleryContainer.addEventListener('mouseenter', stopAutoScroll);
        galleryContainer.addEventListener('mouseleave', startAutoScroll);
        
        // Pause auto-scroll on manual navigation
        prevBtn.addEventListener('click', () => {
            stopAutoScroll();
            setTimeout(startAutoScroll, 3000); // Restart after 3 seconds
        });
        
        nextBtn.addEventListener('click', () => {
            stopAutoScroll();
            setTimeout(startAutoScroll, 3000); // Restart after 3 seconds
        });
        
        // Touch/swipe support for mobile
        let touchStartX = 0;
        let touchEndX = 0;
        
        galleryContainer.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        galleryContainer.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swiped left - go to next
                    galleryContainer.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                } else {
                    // Swiped right - go to previous  
                    galleryContainer.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                }
                stopAutoScroll();
                setTimeout(startAutoScroll, 3000);
            }
        }
    }
    
    // Floor Plan Tabs
    const planTabs = document.querySelectorAll('.floor-plan-tab');
    const planItems = document.querySelectorAll('.floor-plan-item');
    
    planTabs.forEach((tab, index) => {
        tab.addEventListener('click', () => {
            // Remove active classes
            planTabs.forEach(t => t.classList.remove('active'));
            planItems.forEach(item => item.classList.add('hidden'));
            
            // Add active class
            tab.classList.add('active');
            
            // Show corresponding plan
            const planNumber = tab.getAttribute('data-plan');
            const targetPlan = document.getElementById(`floor-plan-${planNumber}`);
            if (targetPlan) {
                targetPlan.classList.remove('hidden');
            }
        });
    });
    
    // Show/Hide Appointment Fields based on interest selection
    const interestSelect = document.getElementById('interest-select');
    const appointmentFields = document.getElementById('appointment-fields');
    
    console.log('=== APPOINTMENT FIELDS DEBUG ===');
    console.log('Interest Select:', interestSelect);
    console.log('Appointment Fields:', appointmentFields);
    console.log('Current display style:', appointmentFields ? appointmentFields.style.display : 'N/A');
    
    if (interestSelect && appointmentFields) {
        console.log('✅ Both elements found! Setting up event listener...');
        console.log('Current dropdown value:', interestSelect.value);
        
        // Function to show/hide appointment fields
        function toggleAppointmentFields(value) {
            console.log('🔄 toggleAppointmentFields called with value:', value);
            
            if (value === 'site_visit') {
                console.log('>>> SHOWING APPOINTMENT FIELDS');
                appointmentFields.style.display = 'block';
                console.log('Display set to:', appointmentFields.style.display);
                console.log('Computed display:', window.getComputedStyle(appointmentFields).display);
                
                // Make date and time required
                const dateInput = appointmentFields.querySelector('[name="appointment_date"]');
                const timeInput = appointmentFields.querySelector('[name="appointment_time"]');
                if (dateInput) {
                    dateInput.setAttribute('required', 'required');
                    console.log('Date input set to required');
                }
                if (timeInput) {
                    timeInput.setAttribute('required', 'required');
                    console.log('Time input set to required');
                }
            } else {
                console.log('>>> HIDING APPOINTMENT FIELDS');
                appointmentFields.style.display = 'none';
                
                // Remove required attribute
                const dateInput = appointmentFields.querySelector('[name="appointment_date"]');
                const timeInput = appointmentFields.querySelector('[name="appointment_time"]');
                if (dateInput) dateInput.removeAttribute('required');
                if (timeInput) timeInput.removeAttribute('required');
            }
        }
        
        // Add multiple event listeners to ensure it works
        interestSelect.addEventListener('change', function() {
            console.log('📢 CHANGE event fired! New value:', this.value);
            toggleAppointmentFields(this.value);
        });
        
        interestSelect.addEventListener('input', function() {
            console.log('📢 INPUT event fired! New value:', this.value);
            toggleAppointmentFields(this.value);
        });
        
        interestSelect.addEventListener('click', function() {
            console.log('🖱️ SELECT clicked, current value:', this.value);
        });
        
        console.log('✅ Event listeners attached successfully!');
    } else {
        console.error('❌ Elements not found - Interest Select:', interestSelect, 'Appointment Fields:', appointmentFields);
    }
    
    // Form Submission
    const form = document.getElementById('project-inquiry-form');
    if (form) {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = form.querySelector('button[type="submit"]');
            const btnText = submitBtn.querySelector('span');
            const btnIcon = submitBtn.querySelector('i');
            
            // Get form data
            const formData = new FormData(form);
            const name = formData.get('name').trim();
            const email = formData.get('email').trim();
            const phone = formData.get('phone').trim();
            const interest = formData.get('interest') || '';
            
            // Validation
            if (!name || !email || !phone) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Additional validation for site visit
            if (interest === 'site_visit') {
                const appointmentDate = formData.get('appointment_date');
                const appointmentTime = formData.get('appointment_time');
                
                if (!appointmentDate || !appointmentTime) {
                    alert('Please select both date and time for your site visit.');
                    return;
                }
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address.');
                return;
            }
            
            // Phone validation
            if (phone.length < 10) {
                alert('Please enter a valid phone number.');
                return;
            }
            
            // Loading state
            btnIcon.className = 'loading-spinner mr-2';
            btnText.textContent = 'Sending...';
            submitBtn.disabled = true;
            
            try {
                // Get CSRF token
                const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
                const projectSlug = formData.get('project_slug');
                
                // Prepare form data
                const submitData = {
                    name: name,
                    email: email,
                    phone: phone,
                    interest: formData.get('interest') || '',
                    message: formData.get('message') || '',
                    appointment_date: formData.get('appointment_date') || '',
                    appointment_time: formData.get('appointment_time') || ''
                };
                
                // Submit form
                const response = await fetch(`/project/project-inquiry/${projectSlug}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken,
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(submitData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Success message
                    alert(result.message || 'Thank you for your inquiry! We will contact you within 24 hours.');
                    form.reset();
                    // Hide appointment fields after reset
                    if (appointmentFields) {
                        appointmentFields.style.display = 'none';
                    }
                } else {
                    // Error message
                    alert(result.error || 'Sorry, there was an error. Please try again.');
                }
                
            } catch (error) {
                console.error('Form submission error:', error);
                alert('Sorry, there was an error. Please try again.');
            } finally {
                // Reset button
                btnIcon.className = 'fas fa-paper-plane mr-2';
                btnText.textContent = 'Send Inquiry';
                submitBtn.disabled = false;
            }
        });
    }
    
    // Floor Plan Access Form Submission
    const floorPlanForm = document.getElementById('floor-plan-access-form');
    if (floorPlanForm) {
        floorPlanForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = floorPlanForm.querySelector('button[type="submit"]');
            const btnText = submitBtn.textContent;
            
            // Get form data
            const formData = new FormData(floorPlanForm);
            const name = formData.get('name').trim();
            const email = formData.get('email').trim();
            const phone = formData.get('phone').trim();
            
            // Validation
            if (!name || !email || !phone) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address.');
                return;
            }
            
            // Phone validation
            if (phone.length < 10) {
                alert('Please enter a valid phone number.');
                return;
            }
            
            // Loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            
            try {
                // Get CSRF token
                const csrfToken = floorPlanForm.querySelector('[name=csrfmiddlewaretoken]').value;
                const projectSlug = formData.get('project_slug');
                
                console.log('Submitting floor plan access request:', {projectSlug, name, email, phone});
                
                // Prepare form data
                const submitData = {
                    name: name,
                    email: email,
                    phone: phone,
                    message: formData.get('message') || ''
                };
                
                // Submit form
                const response = await fetch(`/project/floor-plan-access/${projectSlug}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken,
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(submitData)
                });
                
                console.log('Response status:', response.status);
                const result = await response.json();
                console.log('Response data:', result);
                
                if (result.success) {
                    // Success - close modal and show success message before reload
                    closeFloorPlanModal();
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-[70] flex items-center space-x-3';
                    successDiv.innerHTML = `
                        <i class="fas fa-check-circle text-2xl"></i>
                        <div>
                            <p class="font-bold">Access Granted!</p>
                            <p class="text-sm">Floor plans are now visible. Page will refresh...</p>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    // Set flag in sessionStorage to scroll to floor plans after reload
                    sessionStorage.setItem('scrollToFloorPlans', 'true');
                    
                    // Reload page after 1.5 seconds to show floor plans
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    // Error message
                    alert(result.error || 'Sorry, there was an error. Please try again.');
                    console.error('Floor plan access error:', result.error);
                }
                
            } catch (error) {
                console.error('Floor plan access exception:', error);
                alert('Sorry, there was an error. Please try again.');
            } finally {
                // Reset button
                submitBtn.disabled = false;
                submitBtn.textContent = btnText;
            }
        });
    }
    
    // Close floor plan modal on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeFloorPlanModal();
        }
    });
    
    // Close floor plan modal on outside click
    const floorPlanModal = document.getElementById('floor-plan-modal');
    if (floorPlanModal) {
        floorPlanModal.addEventListener('click', function(e) {
            // Close only if clicking on the backdrop (dark area), not the modal content
            const modalContent = this.querySelector('.bg-white');
            if (e.target === this || !modalContent.contains(e.target)) {
                if (e.target === this) {
                    closeFloorPlanModal();
                }
            }
        });
    }
    
    // Close modal on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modal = document.getElementById('floor-plan-modal');
            if (modal && modal.style.display === 'flex') {
                closeFloorPlanModal();
            }
        }
    });
    
    // Initialize Map
    initializeMap();
});

// Utility Functions
function scrollToForm() {
    document.getElementById('inquiry-form').scrollIntoView({
        behavior: 'smooth',
        block: 'center'
    });
}

function openFloorPlanModal() {
    const modal = document.getElementById('floor-plan-modal');
    if (modal) {
        modal.classList.add('show');
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        console.log('✓ Floor plan modal opened');
    }
}

function closeFloorPlanModal() {
    const modal = document.getElementById('floor-plan-modal');
    if (modal) {
        modal.classList.remove('show');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        console.log('✓ Floor plan modal closed');
    }
}

// Enhanced Image Modal with Zoom & Pan
let currentZoom = 1;
let isDragging = false;
let startX, startY, translateX = 0, translateY = 0;

function openImageModal(src, alt) {
    const modal = document.getElementById('image-modal');
    const img = document.getElementById('modal-image');
    const caption = document.getElementById('modal-caption');
    const downloadBtn = document.getElementById('download-image');
    const loading = document.getElementById('modal-loading');
    const help = document.getElementById('modal-help');
    const container = document.getElementById('image-container');
    
    if (modal && img) {
        // Show loading
        loading.style.display = 'flex';
        
        // Reset zoom and position
        currentZoom = 1;
        translateX = 0;
        translateY = 0;
        img.style.transform = 'scale(1) translate(0, 0)';
        container.classList.remove('zoomed');
        
        // Set image source
        img.src = src;
        img.alt = alt || 'Floor Plan Image';
        
        // Set caption
        if (caption) {
            caption.querySelector('p').textContent = alt || 'Floor Plan Image';
        }
        
        // Set download link
        if (downloadBtn) {
            downloadBtn.href = src;
            downloadBtn.download = alt ? `${alt.replace(/\s+/g, '_')}.jpg` : 'floor_plan.jpg';
        }
        
        // Hide loading when image loads
        img.onload = function() {
            loading.style.display = 'none';
            
            // Show help instructions briefly
            if (help) {
                help.style.opacity = '1';
                setTimeout(() => {
                    help.style.opacity = '0';
                }, 3000);
            }
        };
        
        // Show modal
        modal.classList.add('show');
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function closeImageModal() {
    const modal = document.getElementById('image-modal');
    if (modal) {
        modal.classList.remove('show');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Reset zoom
        currentZoom = 1;
        translateX = 0;
        translateY = 0;
    }
}

function zoomIn() {
    const img = document.getElementById('modal-image');
    const container = document.getElementById('image-container');
    if (currentZoom < 3) {
        currentZoom += 0.25;
        updateImageTransform(img);
        if (currentZoom > 1) {
            container.classList.add('zoomed');
        }
    }
}

function zoomOut() {
    const img = document.getElementById('modal-image');
    const container = document.getElementById('image-container');
    if (currentZoom > 0.5) {
        currentZoom -= 0.25;
        updateImageTransform(img);
        if (currentZoom <= 1) {
            container.classList.remove('zoomed');
            translateX = 0;
            translateY = 0;
        }
    }
}

function resetZoom() {
    const img = document.getElementById('modal-image');
    const container = document.getElementById('image-container');
    currentZoom = 1;
    translateX = 0;
    translateY = 0;
    updateImageTransform(img);
    container.classList.remove('zoomed');
}

function updateImageTransform(img) {
    img.style.transform = `scale(${currentZoom}) translate(${translateX / currentZoom}px, ${translateY / currentZoom}px)`;
}

// Pan functionality
document.addEventListener('DOMContentLoaded', function() {
    const imageContainer = document.getElementById('image-container');
    const img = document.getElementById('modal-image');
    
    if (imageContainer && img) {
        imageContainer.addEventListener('mousedown', function(e) {
            if (currentZoom > 1) {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                imageContainer.style.cursor = 'grabbing';
            }
        });
        
        document.addEventListener('mousemove', function(e) {
            if (isDragging && currentZoom > 1) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateImageTransform(img);
            }
        });
        
        document.addEventListener('mouseup', function() {
            isDragging = false;
            if (imageContainer) {
                imageContainer.style.cursor = 'move';
            }
        });
        
        // Mouse wheel zoom
        imageContainer.addEventListener('wheel', function(e) {
            e.preventDefault();
            if (e.deltaY < 0) {
                zoomIn();
            } else {
                zoomOut();
            }
        });
        
        // Double click to zoom
        img.addEventListener('dblclick', function() {
            if (currentZoom === 1) {
                currentZoom = 2;
            } else {
                currentZoom = 1;
                translateX = 0;
                translateY = 0;
            }
            updateImageTransform(img);
        });
    }
});

// Map Initialization
function initializeMap() {
    const mapContainer = document.getElementById('map');
    if (!mapContainer) return;
    
    const lat = parseFloat(mapContainer.dataset.lat);
    const lng = parseFloat(mapContainer.dataset.lng);
    const title = mapContainer.dataset.title;
    
    if (lat && lng) {
        // Initialize Google Maps or any other map service
        // For now, show a placeholder with coordinates and Google Maps link
        mapContainer.innerHTML = `
            <div class="w-full h-full bg-gray-200 flex items-center justify-center rounded-lg relative overflow-hidden">
                <div class="text-center text-gray-600 z-10 relative">
                    <i class="fas fa-map-marker-alt text-3xl text-red-600 mb-3"></i>
                    <p class="font-bold text-lg">${title}</p>
                    <p class="text-sm mb-3">Premium Location</p>
                    <a href="https://www.google.com/maps?q=${lat},${lng}" 
                       target="_blank" 
                       class="inline-flex items-center bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-red-700 transition-colors">
                        <i class="fas fa-external-link-alt mr-2"></i>
                        View on Google Maps
                    </a>
                </div>
                <div class="absolute inset-0 bg-gradient-to-br from-red-50 to-red-100 opacity-50"></div>
            </div>
        `;
    }
}

// Performance optimizations
let ticking = false;
function updateScrollPosition() {
    const form = document.getElementById('inquiry-form');
    if (form) {
        const rect = form.getBoundingClientRect();
        const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
        
        if (isVisible && !form.classList.contains('visible')) {
            form.classList.add('visible');
            form.style.transform = 'translateY(0)';
            form.style.opacity = '1';
        }
    }
    ticking = false;
}

function requestScrollTick() {
    if (!ticking) {
        requestAnimationFrame(updateScrollPosition);
        ticking = true;
    }
}

// Debounced resize handler
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

const handleResize = debounce(() => {
    // Adjust layout on resize
    const galleryItems = document.querySelectorAll('.gallery-item');
    const galleryItemsFull = document.querySelectorAll('.gallery-item-full');
    const isMobile = window.innerWidth < 768;
    const isTablet = window.innerWidth >= 768 && window.innerWidth < 1024;
    
    // Regular gallery items
    galleryItems.forEach(item => {
        if (isMobile) {
            item.style.flex = '0 0 240px';
            item.style.height = '160px';
        } else {
            item.style.flex = '0 0 280px';
            item.style.height = '200px';
        }
    });
    
    // Full-width gallery items
    galleryItemsFull.forEach(item => {
        if (isMobile) {
            item.style.flex = '0 0 280px';
            item.style.height = '200px';
        } else if (isTablet) {
            item.style.flex = '0 0 400px';
            item.style.height = '280px';
        } else {
            item.style.flex = '0 0 450px';
            item.style.height = '320px';
        }
    });
}, 250);

// Add performance event listeners
window.addEventListener('scroll', requestScrollTick, { passive: true });
window.addEventListener('resize', handleResize, { passive: true });

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeImageModal();
    }
});

// Close modal on outside click
// Click outside to close image modal
document.getElementById('image-modal').addEventListener('click', function(e) {
    // Close if clicking the backdrop (not the image or controls)
    if (e.target === this || e.target.id === 'image-container') {
        closeImageModal();
    }
});

// Keyboard shortcuts for image modal
document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('image-modal');
    if (modal && modal.style.display === 'flex') {
        switch(e.key) {
            case 'Escape':
                closeImageModal();
                break;
            case '+':
            case '=':
                zoomIn();
                break;
            case '-':
            case '_':
                zoomOut();
                break;
            case '0':
                resetZoom();
                break;
        }
    }
});
</script>

{% endblock %}